openapi: '3.0.3'
info:
  title: スケジュール管理API
  version: '1.0.0'
  description: |
    勤怠スケジュール管理・共有アプリケーションのAPI仕様書
    
    ユーザーの勤怠スケジュール（出社、在宅勤務、有給休暇等）を管理・取得するためのAPIです。
    
servers:
  - url: http://localhost:8080
    description: ローカル開発サーバー

paths:
  /api/schedule:
    get:
      summary: スケジュール一覧取得
      description: |
        指定された検索条件に基づき、ユーザーごとのスケジュール一覧を取得します。
        週単位または月単位での表示モードを選択できます。
        
        **スケジュールの優先順位：**
        1. 非定期スケジュール（特定日の個別予定）
        2. 定期スケジュール（曜日ごとの定期予定）
        3. 共通非定期スケジュール（全社員共通の特定日予定）
        4. 共通定期スケジュール（全社員共通の定期予定、例：土日休日）
        5. デフォルトスケジュール（個人のベース勤務パターン）
        6. 共通デフォルトスケジュール（全社員共通のベース勤務パターン）
        
      operationId: getSchedule
      tags:
        - スケジュール
      parameters:
        - name: userId
          in: query
          description: |
            ユーザーID（5桁以内の数字）
            指定した場合、そのユーザーのスケジュールのみを取得します。
          required: false
          schema:
            type: string
            pattern: '^[0-9０-９]{0,5}$'
            example: "00001"
            
        - name: week
          in: query
          description: |
            対象週（ISO 8601形式: YYYY-Www）
            viewModeがWEEKの場合に必須。
            月曜始まりの週で、1年の第1週から第53週まで指定可能。
          required: false
          schema:
            type: string
            pattern: '^\d{4}-W(0[1-9]|[1-4][0-9]|5[0-3])$'
            example: "2025-W02"
            
        - name: month
          in: query
          description: |
            対象月（YYYY-MM形式）
            viewModeがMONTHの場合に必須。
          required: false
          schema:
            type: string
            pattern: '^\d{4}-(0[1-9]|1[0-2])$'
            example: "2025-01"
            
        - name: viewMode
          in: query
          description: |
            表示モード
            - WEEK: 週単位で表示（週の開始日〜終了日の7日分）
            - MONTH: 月単位で表示（月の1日〜末日）
          required: true
          schema:
            type: string
            enum:
              - WEEK
              - MONTH
            example: "WEEK"
            
        - name: name
          in: query
          description: |
            名前検索（部分一致、50文字以内）
            スペース区切りで複数指定可能（AND検索）
            例：「山田 太郎」は「山田」かつ「太郎」を含む名前を検索
          required: false
          schema:
            type: string
            maxLength: 50
            example: "山田太郎"
            
        - name: organizationCode
          in: query
          description: |
            組織コード（3桁以内の数字）
            指定した組織に所属するユーザーのスケジュールを取得します。
          required: false
          schema:
            type: string
            pattern: '^\d{0,3}$'
            example: "006"
            
      responses:
        '200':
          description: 正常にスケジュールを取得
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDTO'
              examples:
                週表示例:
                  summary: 週表示モードでの取得例（2025年第2週）
                  value:
                    - userName: "山田太郎"
                      organizationName: "開発部"
                      schedules:
                        - scheduleId: 1
                          date: "2025-01-06"
                          startTime: "09:00:00"
                          endTime: "18:00:00"
                          worktypeName: "在宅勤務"
                          worktypeColor: "#2196F3"
                          scheduleType: "REGULAR"
                        - scheduleId: 2
                          date: "2025-01-07"
                          startTime: "09:00:00"
                          endTime: "18:00:00"
                          worktypeName: "在宅勤務"
                          worktypeColor: "#2196F3"
                          scheduleType: "REGULAR"
                        - scheduleId: 0
                          date: "2025-01-11"
                          startTime: null
                          endTime: null
                          worktypeName: "休日"
                          worktypeColor: "#E91E63"
                          scheduleType: "COMMON_REGULAR"
                          
                月表示例:
                  summary: 月表示モードでの取得例（複数ユーザー）
                  value:
                    - userName: "山田太郎"
                      organizationName: "開発部"
                      schedules:
                        - scheduleId: 1
                          date: "2025-01-06"
                          startTime: "09:00:00"
                          endTime: "18:00:00"
                          worktypeName: "在宅勤務"
                          worktypeColor: "#2196F3"
                          scheduleType: "REGULAR"
                    - userName: "佐藤花子"
                      organizationName: "開発部"
                      schedules:
                        - scheduleId: 3
                          date: "2025-01-06"
                          startTime: "10:00:00"
                          endTime: "19:00:00"
                          worktypeName: "在宅勤務"
                          worktypeColor: "#2196F3"
                          scheduleType: "REGULAR"
                          
        '400':
          description: バリデーションエラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                週・月の両方指定エラー:
                  summary: weekとmonthの両方が指定された場合
                  value:
                    status: 400
                    error: "Bad Request"
                    message: "Only one of week or month can be provided"
                    
                viewMode不一致エラー:
                  summary: viewModeとweek/monthが不一致の場合
                  value:
                    status: 400
                    error: "Bad Request"
                    message: "Week must be provided when viewMode is WEEK"

                月表示モード不一致エラー:
                  summary: viewModeとweek/monthが不一致の場合
                  value:
                    status: 400
                    error: "Bad Request"
                    message: "Month must be provided when viewMode is MONTH"

                週表示モード不一致エラー:
                  summary: viewModeとweek/monthが不一致の場合
                  value:
                    status: 400
                    error: "Bad Request"
                    message: "Week must be provided when viewMode is WEEK"

                フォーマットエラー:
                  summary: パラメータのフォーマットが不正な場合
                  value:
                    status: 400
                    error: "Bad Request"
                    message: "Validation failed for parameter 'week'"

components:
  schemas:
    UserDTO:
      type: object
      description: ユーザーとそのスケジュール情報
      required:
        - userName
        - organizationName
        - schedules
      properties:
        userName:
          type: string
          description: ユーザーの氏名
          example: "山田太郎"
          maxLength: 50
        organizationName:
          type: string
          description: 所属組織名
          example: "開発部"
          maxLength: 100
        schedules:
          type: array
          description: スケジュールのリスト（日付順にソート済み）
          items:
            $ref: '#/components/schemas/ScheduleDTO'
            
    ScheduleDTO:
      type: object
      description: 個別スケジュール情報
      required:
        - scheduleId
        - date
      properties:
        scheduleId:
          type: integer
          description: |
            スケジュールID
            該当するスケジュールがない場合は0
          example: 1
        date:
          type: string
          format: date
          description: スケジュールの対象日
          example: "2025-01-06"
        startTime:
          type: string
          format: time
          nullable: true
          description: |
            開始時刻（HH:mm:ss形式）
            休日など時刻が設定されていない場合はnull
          example: "09:00:00"
        endTime:
          type: string
          format: time
          nullable: true
          description: |
            終了時刻（HH:mm:ss形式）
            休日など時刻が設定されていない場合はnull
          example: "18:00:00"
        worktypeName:
          type: string
          nullable: true
          description: |
            勤怠種別名
            該当するスケジュールがない場合はnull
          example: "在宅勤務"
          enum:
            - "出社"
            - "在宅勤務"
            - "有給休暇"
            - "病気休暇"
            - "代休"
            - "出張"
            - "研修"
            - "会議"
            - "外出"
            - "半休（午前）"
            - "半休（午後）"
            - "休日"
        worktypeColor:
          type: string
          nullable: true
          description: |
            表示用カラーコード（16進数）
            該当するスケジュールがない場合はnull
          example: "#2196F3"
          pattern: '^#[0-9A-F]{6}$'
        scheduleType:
          type: string
          nullable: true
          description: |
            スケジュールの種別
            該当するスケジュールがない場合はnull
          example: "REGULAR"
          enum:
            - "IRREGULAR"
            - "REGULAR"
            - "COMMON_IRREGULAR"
            - "COMMON_REGULAR"
            - "DEFAULT"
            - "COMMON_DEFAULT"
            
    Error:
      type: object
      description: エラーレスポンス
      required:
        - status
        - error
        - message
      properties:
        status:
          type: integer
          description: HTTPステータスコード
          example: 400
        error:
          type: string
          description: エラー種別
          example: "Bad Request"
        message:
          type: string
          description: エラーの詳細メッセージ
          example: "Only one of week or month can be provided"

tags:
  - name: スケジュール
    description: スケジュール管理に関するAPI
